package de.infolektuell.gradle.jextract.extensions;

import org.gradle.api.Action;
import org.gradle.api.Named;
import org.gradle.api.file.Directory;
import org.gradle.api.file.DirectoryProperty;
import org.gradle.api.file.RegularFileProperty;
import org.gradle.api.provider.ListProperty;
import org.gradle.api.provider.Property;
import org.gradle.api.tasks.Nested;
import org.jspecify.annotations.NonNull;

/// A configuration for a library to be generated by Jextract
public abstract class LibraryHandler implements Named {
    /// Creates a new instance
    public LibraryHandler() { super(); }
    /// The header file to generate bindings for
    /// @return A property to configure the header file
    public abstract RegularFileProperty getHeader();

    /// Additional directories where Jextract and Jmod should search for header files
    /// @return A property to add more include directories
    public abstract ListProperty<@NonNull Directory> getIncludes();

    /// Additional directories where Jmod should search for native runtime binaries
    /// @return A property to add more library search directories
    public abstract ListProperty<@NonNull Directory> getLibraryPath();

    /// Macros to be defined, in the format `name=value`
    /// @return A property to add defined macros
    public abstract ListProperty<@NonNull String> getDefinedMacros();

    /// The package name for the generated code
    /// @return A property to configure the package name
    public abstract Property<@NonNull String> getTargetPackage();

    /// The name for the class generated from the header file, derived from the header file if missing
    /// @return A property to configure the header class name
    public abstract Property<@NonNull String> getHeaderClassName();

    /// List of definitions to be included
    /// @return A list handler to configure the include definitions
    @Nested
    public abstract WhitelistHandler getWhitelist();

    /// Configures the list of definitions to be included
    /// @param action The configuration action to be applied to the white-list
    public final void whitelist(Action<@NonNull WhitelistHandler> action) {
        action.execute(this.getWhitelist());
    }

    /// Native libraries to be loaded by generated code (either names or paths starting with colon)
    /// @return A property to add library names
    public abstract ListProperty<@NonNull String> getLibraries();

    /// Load libraries in the library symbol lookup, using either `System.load` or `System.loadLibrary`, useful for libraries in java.library.path
    /// @return A boolean property
    public abstract Property<@NonNull Boolean> getUseSystemLoadLibrary();

    /// specify the directory to place generated files.
    /// @return a property to configure the output directory
    public abstract DirectoryProperty getOutput();

    /// Generate source files instead of class files (Jextract 21 and below)
    /// @return a boolean property
    public abstract Property<@NonNull Boolean> getGenerateSourceFiles();
}
